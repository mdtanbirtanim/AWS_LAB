# How to create a custome VPC environment in AWS

## Step 1: On AWS Account
    
    Login to your AWS console and select Region (We considered "Tokyo").
	Navigate to the VPC, On the VPC Dashboard, select Your VPCs, and  then select "Create VPC".
	In Name tag, We considered the name of VPC as "awslab", in IPv4 CIDR block, we entered "10.0.0.0/16", & then select "Create VPC".

    NB: We left "Tenancy" to default

## Step 2: Create Public & Private Subnet
    We are going to create 2 Public Subnets & 2 Private Subnets
    On the Subnet page, select "Create Subnet"
    In VPC ID, select "awslab"

    For Public Subnet 1, we considered following 
        Subnet Name: Public Subnet 1"
        Availability Zone: "ap-northeast-1a"
        IPv4 CIDR block: "10.0.0.0 /24"  > Then select "Create Subnet"

    For Public Subnet 2, we considered following information
        Subnet Name: "Public Subnet 2"
        Availability Zone: "ap-northeast-1c"
        IPv4 CIDR block: "10.0.1.0/24" > Then select "Create Subnet"
        
    To enable auto-assign piblic IPv4 address follow the below  procedure (NB: Applicable only for public subnet)
         Click on "Public Subnet 1" check box > "Action" >  "Edit subnet setting" > Do Tick mark on "Enable auto-assign public IPv4 address" > "Save"

    For Private Subnet 1, we considered below information
        Subnet Name: "Private Subnet 1"
        Availability Zone: "ap-northeast-1a"
        IPv4 CIDR block: "10.0.2.0/24" > Then select "Create Subnet"

    For Private Subnet 2, we considered below information
        Subnet Name: "Private Subnet 2"
        Availability Zone: "ap-northeast-1c"
        IPv4 CIDR block: "10.0.3.0/24" > Then select "Create Subnet"

Resourses:
- https://docs.aws.amazon.com/vpc/latest/userguide/VPC_Subnets.html#subnet-basics
- For Subnet Creator https://network00.com/NetworkTools/IPv4SubnetCreator/
- For CIDR Range https://cidr.xyz/

## Step 3: Create an Internet Gateway (IG)

    On the VPC Dashboard, Navigate to Internet Gateways and select "Create internet gateway".
	In Name tag we considered "awslab IG", and then select "Create internet gateway".

	After creating IG, do following paths
        Navigate to IG > Select "awslab IG" check box >
        Select Actions > Attach to VPC > In Available VPCs, select "awslab" > Attach internet gateway.
## Step 4: Create a NAT gateway

    In this phase we are going to create a NAT Gateways to allow communication out of the private subnets.
    NAT Gateways require an Elastic IP (Public IP) so we need 1 Public IP for our requirement.

    1. On the VPC Dashboard, in the navigation pane, select "NAT Gateways".
    2. Click "Create NAT gateway".
    3. In Name, we considered "awslab Gateway 1" > then in Subnet, select "Public Subnet 1".
    4. Select "Allocate Elastic IP (Public IP)
    5. then select "Create NAT Gateway".

## Step 5: Configure the Public Route Table (RT) & Private Route Table (RT)

    Here we considered 2 RT 
        1. awslab Public RT
        2. awslab Private RT

    Let's configure the public route table first. As one of RT is generated by default let's rename it "awslab Public RT"
     then select the pencil icon.Enter Public Route Table,

    On the VPC Dashboard, in the navigation pane, select Route Tables.
    Expand the VPC ID column, locate the route that has a awslab >  then select the pencil icon enter "awslab Public RT"

    Now we need to attach Internet Gateway (IGW) to our public RT
        1. select the check box for the awslab row.
        2. select the Routes tab.
        3. Click Edit routes 
        4.  "   Add route
        5. In Destination, enter 0.0.0.0/0
        6. In the Target drop-down list, select Internet Gateway > 
        7. click  the "awslab IG".
        8. Save

	Now associate "Public Subnet" into "Public RT"
	    1. Click on "Subnet Associations"
	    2.   "	on "Edit subnet associations"
	    3. Do tick mark on "Public Subnet 1 & Public Subnet 2 check box"
	    4. Click "Save Associations"

    Now we need to create another RT for our private subnet
        1. Navigate to "Route Tables", click on "Cretae route table"
        2. We considered to give the name as "awslab Private RT"
        3. Select the VPC "awslab"
        4. Click "Create route table"
        5. In this same page, click "Routes" tab of awslab Private RT and click "Edit routes"
        6. Click add route
        7. For Destination input "0.0.0.0/0"
        8. For Target select NAT Gateway > awslab NAT Gateway 1 > and Save
        9. Now Select "Subnet associations" tab of awslab Private RT and Click "Edit subnet associations" 
        10. Tick mark on "Private Subnet 1" & "Private Subnet 2"
        11. Save
Useful:
https://docs.aws.amazon.com/vpc/latest/userguide/VPC_Route_Tables.html#RouteTables


## Step 6: We left the Network ACL to defaoult as it is created by default  (If you would like to reconfigure please do)

## Step 7: Let's create Security Group

        1. On the VPC console, click on "Security Groups"
        2. Click on "Create Security Group"
        3. Give it a Security group name & Description. We considered Security group name as "awslab SG" and Description as "Allow SSH & HTTP Access"
        4. In VPC, choose "awslab"
        4. Configure Inbound and Outbound rules. We just allowed inbound HTTP and SSH by clicking "Add rule" and left outbound rules as it is.
        5. Save

## Step 8: Finally let's launch a EC2 instance to verify all our creadted services work or not
    
   To launch a EC2 instance follow this URL https://docs.aws.amazon.com/efs/latest/ug/gs-step-one-create-ec2-resources.html
   
   We are going to launch EC2 instance and choose required services which we created like VPC, Subnet, SG 

    1. We launched a EC2 Instance (Amazon Linux)
    2. Installed Web Server on it by pasting "User Data"
                #!/bin/bash
                yum update -y
                yum install -y httpd
                systemctl start httpd
                systemctl enable httpd
                echo “Hello World from $(hostname -f)” > /var/www/html/index.html
    3. As result, 
        - We successfully SSH to EC2 Machine
        - Got HTTP access from Web Server



## Resources
- https://docs.aws.amazon.com/vpc/index.html
- For Subnet Creator https://network00.com/NetworkTools/IPv4SubnetCreator/
- For CIDR Range https://cidr.xyz/